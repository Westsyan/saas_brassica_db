@()(implicit session: Session)
<style>
        .social-nav {
            position: absolute;
            top: 31px;
            right: 0px;
            overflow: hidden;
            width: auto;
            display: inline-block;
            text-align: center
        }

        .social-nav li {
            display: inline-block;
            vertical-align: middle;
            width: 41px;
            height: 41px;
            margin-left: 5px;
            border: 1px solid #dfdfdf;
            border-radius: 22px;
            -moz-border-radius: 22px;
            -webkit-border-radius: 22px;
        }

        .social-nav li a {
            display: inline-block;
            width: 100%;
            height: 41px;
        }

        .top-logo {
            color: #555;
            font-size: 20px;
            line-height: 40px;
        }

        .rss:hover {
            border-color: #555;
        }

        .rss a:hover {
            color: #555;
            text-decoration: none !important;
        }

</style>

<header id="header">

        <!--Main Header-->
    <div id="main-header">
        <div class="container">
            <div class="grid_12">

                    <!-- BEGIN LOGO -->
                <div id="logo">
                    <img src="/assets/images/logo1.png">

                </div>
                <div>
                    <span style="color: #1E648D;
                        font-size: 35px;
                        line-height: 90px;"> SAAS |  Brassica Genome Database</span>
                </div>

                <ul class="social-nav">
                    <li class="rss">
                        <a class="top-logo" href="javascript:toChinese();">中 </a>
                    </li>
                    <li class="rss">
                        <a class="top-logo" href="javascript:toChinese();">OR </a>
                    </li>
                    @if(session.get("userId").isEmpty) {
                        <li class="rss"><a href="#" class="signin" data-reveal-id="signin" title="Sign in"><i class="fa fa-sign-in top-logo"></i></a></li>
                    } else {
                        <li class="rss"><a href="#" class="signin" data-reveal-id="newpassword" title="New password"><i class="fa fa-edit top-logo"></i></a></li>
                        <li class="rss"><a onclick="Signout()" title="Sign out"><i class="fa fa-sign-out top-logo"></i></a></li>
                    }
                    </ul>

            </div>
        </div>
    </div>

</header>

<section id="slider">

    <div class="container">
        <div class="grid_12">

            <nav class="primary">
                <ul class="sf-menu">
                    <li><a href="@routes.HomeController.index()">Home</a></li>
                    <li class="empty-item">
                        <a href="#">Genome <i class="fa fa-angle-down"></i></a>
                        <ul>
                            <li><a href="@routes.GenomeController.browseBeforeUS()">Browse</a></li>
                            <li><a href="@routes.GenomeController.conditionSearchBeforeUS()">Condition Search</a></li>
                            <li><a href="http://192.168.0.118:8080/jb/index.html?data=my_data/Brassica/data" target="_blank">
                                Genome Browser</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#">Tools <i class="fa fa-angle-down"></i></a>
                        <ul>
                            <li><a href="@routes.ToolsController.lastzBeforeUS()">Lastz</a></li>
                            <li><a href="@routes.ToolsController.primerBeforeUS()">Primer</a></li>
                            <li><a href="@routes.ToolsController.muscleBeforeUS()">Muscle</a></li>
                            <li><a href="@routes.ToolsController.geneWiseBeforeUS()">GeneWise</a></li>
                            <li><a href="@routes.ToolsController.blastBeforeUS()">Blast Search</a></li>
                            <li><a href="@routes.ToolsController.seqFetchBeforeUS()">Sequences Fetch</a></li>
                            <li><a href="@routes.ToolsController.enrichmentBeforeUS()">Enrichment analysis</a></li>

                        </ul>
                    </li>
                    <li><a href="@routes.DownloadController.downloadBeforeUS()">Download</a></li>
                    <li><a href="@routes.NgsController.upload()">NGS</a></li>
                    <li><a href="#">Contact</a></li>


                </ul>
            </nav>

        </div>
        @if(session.get("user").nonEmpty) {
            <span style="float: right;
                color: white;
                font-size: 19px;
                line-height: 50px">
                <i>Hi,@session.get("user")</i>
            </span>
        }

    </div>

</section>


    <!-- BEGIN MODAL WINDOWS -->
<div id="signin" class="reveal-modal">
    <header class="reveal-modal-header">

    </header>
    <div class="cont">
        <div class="indication">
            Sign in
        </div>
        <form action="#" class="signup form-horizontal" id="signinForm">
            <div class="form-group">
                <label class="control-label col-sm-4">User:</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" name="user"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4">Password:</label>
                <div class="col-sm-7">
                    <input type="password" class="form-control" name="password"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4">User verification:</label>
                <div class="col-sm-7">
                    <input type = "text" id = "validnumber" name="validnumber" autofocus="autofocus" style="float: left;
                        width: 165px;
                        margin-left: 2px;" required />
                    <input type = "button" class="code" onclick="createCode()"
                    style="width: 50px;
                        height: 30px;
                        margin-left: 5px;
                        border: 1px solid #d8d8d8;" />
                </div>
            </div>

            <p class="without-label clearfix" style="margin-top: 45px">
                <button type="submit" onclick="Signin()" class="btn btn-primary btn-green" style="width: 100px;">
                    Sign in</button>
                <a class="signup" data-reveal-id="signup"></a>
                <button type="button" class="btn btn-primary btn-green" style="width: 100px;
                    margin-left: 45px;" onclick="openSignup()">Sign up</button>
            </p>
        </form>
    </div>
    <a class="close-reveal-modal">&#215;</a>
</div>

    <!-- BEGIN MODAL WINDOWS -->
<div id="signup" class="reveal-modal">
    <header class="reveal-modal-header">

    </header>
    <div class="cont">
        <div class="indication">
            Sign up
        </div>
        <form action="" class="signup form-horizontal" id="signupForm">
            <div class="form-group">
                <label class="control-label col-sm-4">User:</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" name="user" >
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4">Password:</label>
                <div class="col-sm-7">
                    <input type="password" class="form-control" name="password">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4">Password (repeat):</label>
                <div class="col-sm-7">
                    <input type="password" class="form-control" name="password1">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4">User verification:</label>
                <div class="col-sm-7">
                    <input type = "text" id = "validnumber1" name="validnumber" class="form-control" autofocus="autofocus" style="float: left;
                        width: 165px;
                        margin-left: 2px;" required >
                    <input type = "button" class="code" onclick="createCode()"
                    style="width: 50px;
                        height: 30px;
                        margin-left: 5px;
                        border: 1px solid #d8d8d8;" >
                </div>

            </div>

            <p class="without-label clearfix" style="margin-top: 45px">
                <button type="submit" onclick="Signup()" class="btn btn-primary btn-green" style="width: 100px;
                    margin-left: 50px;
                ">Sign up</button>
            </p>
        </form>
    </div>
    <a class="close-reveal-modal">&#215;</a>
</div>

<div id="newpassword" class="reveal-modal">
    <header class="reveal-modal-header">

    </header>
    <div class="cont">
        <div class="indication">
            New Password
        </div>
        <form class="signup form-horizontal" id="passwordForm">
            <div class="form-group">
                <label class="control-label col-sm-4">User:</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" name="user" value="@session.get("user")" readonly>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4">Password:</label>
                <div class="col-sm-7">
                    <input type="password" class="form-control" name="password">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4">New Password:</label>
                <div class="col-sm-7">
                    <input type="password" class="form-control" name="password1">
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-sm-4">Password(repeat):</label>
                <div class="col-sm-7">
                    <input type="password" class="form-control" name="password2">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4">User verification:</label>
                <div class="col-sm-7">
                    <input type = "text" id = "validnumber2" name="validnumber" class="form-control" autofocus="autofocus" style="float: left;
                        width: 165px;
                        margin-left: 2px;" required >
                    <input type = "button" class="code" onclick="createCode()"
                    style="width: 50px;
                        height: 30px;
                        margin-left: 5px;
                        border: 1px solid #d8d8d8;" >
                </div>

            </div>

            <p class="without-label clearfix" style="margin-top: 45px">
                <button type="submit" onclick="changePassword()" class="btn btn-primary btn-green" style="width: 100px;
                    margin-left: 50px;
                ">Change</button>
            </p>
        </form>
    </div>
    <a class="close-reveal-modal">&#215;</a>
</div>


<script>

        $(function () {
            createCode();
            formValidation();
        });


        var path = window.location.pathname;


        function toChinese() {
            var parameter = window.location.search;
            var path1 = path.split("/");
            var path2 = "/CN/" + path1[2] + "/" + path1[3] + "/" + path1[4] + "/" + path1[5] + parameter;
            window.location.href = path2;
        }

        var code ; //在全局定义验证码

        function openSignup() {
            $(".close-reveal-modal").click();
            $(".signup").click();
            createCode();
        }

        function createCode() {
            code = "";
            var codeLength = 4;//验证码的长度
            var random = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9);//随机数
            for (var i = 0; i < codeLength; i++) {//循环操作
                var index = Math.floor(Math.random() * 10);//取得随机数的索引（0~35）
                code += random[index];//根据索引取得随机数加到code上
            }
            $(".code").val(code);//把code值赋给验证码
        }

        function Signout() {
            window.location.href = "/SAAS/BGDB/User/signout?path=" + path;
        }

        //登录
        function Signin() {
            var form = $("#signinForm");
            var fv = form.data("formValidation");
            fv.validate();
            if (fv.isValid()) {
                $.ajax({
                    url: "@routes.UserController.signIn()",
                    type: "post",
                    dataType: "json",
                    data: form.serialize(),
                    success: function (data) {
                        if (data.valid === "false") {
                            swal({
                                title: "Error",
                                text: "Incorrect account or password",
                                type: "error",
                                confirmButtonText: "OK"
                            })
                        } else {
                            window.location.href = "/SAAS/BGDB/User/signInSuccess?path=" + path + "&id=" + data.id;
                        }
                    }
                });
            }
        }

        //注册
        function Signup() {
            var form = $("#signupForm");
            var fv = form.data("formValidation");
            fv.validate();
            if (fv.isValid()) {
                $.ajax({
                    url: "@routes.UserController.addUser()",
                    type: "post",
                    dataType: "json",
                    data: form.serialize(),
                    success: function (data) {
                        if (data.valid == "false") {
                            swal({
                                title: "错误!",
                                text: data.message,
                                type: "error",
                                confirmButtonText: "确定"
                            })
                        } else {
                            $(".close-reveal-modal").click();
                            swal({
                                title: "Success",
                                text: "Sign up success!",
                                type: 'success',
                                confirmButtonText: "Click to sign in!"
                            }, function () {

                                $(".signin").click();
                                createCode();
                            })
                        }
                    }
                });
            }

        }

        //修改密码
        function changePassword() {
            var form = $("#passwordForm");
            var fv = form.data("formValidation");
            fv.validate();
            if (fv.isValid()) {
                $.ajax({
                    url: "@routes.UserController.changePassword()",
                    type: "post",
                    dataType: "json",
                    data: form.serialize(),
                    success: function (data) {
                        if (data.valid == "false") {
                            swal({
                                title: "Error!",
                                text: data.message,
                                type: "error",
                                confirmButtonText: "OK"
                            })
                        } else {
                            $(".close-reveal-modal").click();
                            swal({
                                title: "Success",
                                text: "Change password success!",
                                type: 'success',
                                confirmButtonText: "Click on the return!"
                            }, function () {
                                window.location.href = "/SAAS/BGDB/User/signout?path=" + path;
                            })
                        }
                    }
                });
            }

        }

        function formValidation() {
            $('#signinForm').formValidation({
                framework: 'bootstrap',
                icon: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    user: {
                        validators: {
                            notEmpty: {
                                message: 'User is required！'
                            }
                        }
                    },
                    password: {
                        validators: {
                            notEmpty: {
                                message: 'Password is required！'
                            }
                        }
                    },
                    validnumber: {
                        validators: {
                            notEmpty: {
                                message: "User verification is required！"
                            },
                            callback: {
                                message: 'User verification error！',
                                callback: function () {
                                    return $("#validnumber").val() === code;
                                }
                            }
                        }
                    }
                }
            });
            $('#signupForm').formValidation({
                framework: 'bootstrap',
                icon: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    user: {
                        validators: {
                            notEmpty: {
                                message: 'User is required！'
                            }
                        }
                    },
                    password: {
                        validators: {
                            notEmpty: {
                                message: 'Password is required！'
                            },
                            stringLength: {
                                min: 6,
                                message: "Enter a minimum 6 digit password！"
                            }
                        }
                    },
                    password1: {
                        validators: {
                            notEmpty: {
                                message: 'Password(repeat) is required！'
                            },
                            identical: {
                                field: 'password',
                                message: 'Does not match the password you entered!'
                            }
                        }
                    },
                    validnumber: {
                        validators: {
                            notEmpty: {
                                message: "User verification is required！"
                            },
                            callback: {
                                message: 'User verification error！',
                                callback: function () {
                                    return $("#validnumber1").val() === code;
                                }
                            }
                        }
                    }
                }
            });
            $('#passwordForm').formValidation({
                framework: 'bootstrap',
                icon: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    password: {
                        validators: {
                            notEmpty: {
                                message: 'Password is required！'
                            }
                        }
                    },
                    password1: {
                        validators: {
                            notEmpty: {
                                message: 'New Password is required！'
                            },
                            stringLength: {
                                min: 6,
                                message: "Enter a minimum 6 digit password！"
                            }
                        }
                    },
                    password2: {
                        validators: {
                            notEmpty: {
                                message: 'Password(repeat) is required！'
                            },
                            identical: {
                                field: 'password1',
                                message: 'Does not match the password you entered!'
                            }
                        }
                    },
                    validnumber: {
                        validators: {
                            notEmpty: {
                                message: "User verification is required！"
                            },
                            callback: {
                                message: 'User verification error！',
                                callback: function () {
                                    return $("#validnumber2").val() === code;
                                }
                            }
                        }
                    }
                }
            });
        }


</script>


